@page "/income-distribution"

@inject IncomeDistributionService IncomeService

    <h3>Распределение доходов по планам</h3>

    @if (incomeDistributions != null)
{
    <table class="table">
        <thead>
        <tr>
        <th>Дата дохода</th>
        <th>Источник дохода</th>
        <th>Сумма дохода</th>
        <th>План</th>
        <th>Распределенная сумма</th>
        <th>Процент</th>
        </tr>
        </thead>
        <tbody>
        @foreach (var income in incomeDistributions)
    {
        bool firstRow = true;
        foreach (var planDist in income.PlanDistributions)
        {
            <tr>
                @if (firstRow)
            {
                <td rowspan="@income.PlanDistributions.Count">@income.IncomeDate:yyyy-MM-dd</td>
                    <td rowspan="@income.PlanDistributions.Count">@income.IncomeSource</td>
                    <td rowspan="@income.PlanDistributions.Count">@income.IncomeAmount.ToString("C")</td>
                    firstRow = false;
            }
            <td>@planDist.PlanName</td>
                <td>@planDist.DistributedAmount.ToString("C")</td>
                <td>@planDist.Percentage:F2%</td>
                </tr>
        }
    }
    </tbody>
        </table>
}
else
{
    <p>Загрузка данных...</p>
}

@code {
private List<IncomeDistributionItem> incomeDistributions;

protected override void OnInitialized()
{
    incomeDistributions = IncomeService.GetIncomeDistributions();
}
}